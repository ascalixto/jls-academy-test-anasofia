rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ==========================================
    // DEVELOPMENT RULES - REMOVE BEFORE PRODUCTION
    // ==========================================
    // These exist because Firebase Auth is not set up yet.
    // They keep the sandbox usable during development.
    //
    // RISKS:
    // - Anyone can read/write/delete all data
    // - Users can bypass the UI and use the SDK directly
    // - Can cause billing abuse
    //
    // BEFORE PRODUCTION:
    // - Implement Firebase Auth
    // - Remove these rules
    // - Uncomment the production rules below
    // ==========================================

    match /productIdeas/{ideaId} {
      allow read, write: if true;

      match /notes/{noteId} {
        allow read, write: if true;
      }
    }

    // ==========================================
    // PRODUCTION RULES (commented out for now)
    // Assignment: Add validation functions
    // ==========================================

    // ---------- Auth & Ownership Helpers ----------
    // function isSignedIn() {
    //   return request.auth != null;
    // }
    //
    // function isUser(userId) {
    //   return isSignedIn() && request.auth.uid == userId;
    // }
    //
    // function isOwner() {
    //   return isUser(resource.data.ownerId);
    // }
    //
    // function isCreatingOwned() {
    //   return isUser(request.resource.data.ownerId);
    // }

    // ---------- Validation Helpers ----------
    // function hasRequiredFields(data, fields) {
    //   return data.keys().hasAll(fields);
    // }
    //
    // function isValidStatus(status) {
    //   return status in ['draft', 'active', 'paused', 'shipped'];
    // }
    //
    // function isValidProductIdea(data) {
    //   return hasRequiredFields(
    //            data,
    //            ['title', 'status', 'ownerId', 'tags']
    //          )
    //     && data.title is string
    //     && data.title.size() > 0
    //     && data.title.size() < 100
    //     && data.status is string
    //     && isValidStatus(data.status)
    //     && data.tags is list
    //     && data.tags.size() <= 10;
    // }
    //
    // function isValidNote(data) {
    //   return hasRequiredFields(
    //            data,
    //            ['body', 'authorId']
    //          )
    //     && data.body is string
    //     && data.body.size() > 0
    //     && data.body.size() <= 2000;
    // }

    // ---------- Product Ideas ----------
    // match /productIdeas/{ideaId} {
    //
    //   // Read
    //   allow read: if isSignedIn();
    //
    //   // Create
    //   allow create: if isCreatingOwned()
    //                 && isValidProductIdea(request.resource.data);
    //
    //   // Update
    //   allow update: if isOwner()
    //                 && isValidProductIdea(request.resource.data);
    //
    //   // Delete
    //   allow delete: if isOwner();
    //
    //   // ---------- Notes ----------
    //   match /notes/{noteId} {
    //
    //     // Read
    //     allow read: if isSignedIn();
    //
    //     // Create
    //     allow create: if isUser(request.resource.data.authorId)
    //                   && isValidNote(request.resource.data);
    //
    //     // Update
    //     allow update: if false;
    //
    //     // Delete
    //     allow delete: if isUser(resource.data.authorId);
    //   }
    // }

  }
}
